(window["webpackJsonpguodada-react-blog"]=window["webpackJsonpguodada-react-blog"]||[]).push([[10],{654:function(e,t,a){"use strict";a(59);var n=a(3),r=(a(166),a(72)),c=(a(218),a(73)),i=a(0),l=a.n(i),o=a(28),s=a(64),m=a(30),u=a(66);function d(e,t){var a=t.find((function(t){return t.name===e}));return a?a.color:""}t.a=Object(s.i)((function(e){var t=Object(m.d)((function(e){return e.article.tagList})),a=e.tagList,i=e.categoryList;return l.a.createElement(l.a.Fragment,null,a.length>0&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.a,{type:"vertical",style:{marginRight:7}}),l.a.createElement(u.a,{type:"icontags",style:{marginRight:7}}),a.map((function(e,a){return l.a.createElement(r.a,{key:a,color:d(e.name,t)},l.a.createElement(o.b,{to:"/tags/".concat(e.name)},e.name))}))),i.length>0&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.a,{type:"vertical",style:{marginRight:7}}),l.a.createElement(n.a,{type:"folder",style:{marginRight:7}}),i.map((function(e,t){return l.a.createElement(r.a,{key:t,color:"#2db7f5"},l.a.createElement(o.b,{to:"/categories/".concat(e.name)},e.name))}))))}))},672:function(e,t,a){},673:function(e,t,a){},704:function(e,t,a){"use strict";a.r(t);a(219);var n=a(128),r=(a(633),a(634)),c=(a(59),a(3)),i=(a(218),a(73)),l=a(71),o=a(24),s=a(0),m=a.n(s),u=(a(672),a(167)),d=a(46),p=a(41);function f(){var e=Object(s.useState)(!1),t=Object(o.a)(e,2),a=t[0],n=t[1];return[a,function(e){if(e instanceof Promise)return new Promise((function(t,a){n(!0),e.then((function(e){t(e),n(!1)})).catch((function(e){a(e),n(!1)}))}))}]}var g=a(654),y=a(66),E=(a(648),a(644)),b=E.a.Link;function h(e){var t=[];return e.replace(/<(h[1-6])[\s\S]+?(?=<\/\1>)/g,(function(e,a){var n=e.replace(/.*?>/,""),r=e.indexOf('"'),c=e.indexOf('">'),i="#".concat(e.slice(r+1,c));!function e(t,a){var n=t[t.length-1];n&&n.tag!==a.tag?e(n.children,a):t.push(a)}(t,{tag:a,title:n,href:i,children:[]})})),t}var v,O=function(e){var t=h(e.content);return m.a.createElement(E.a,{affix:!1},t.map((function e(t){var a=t.href,n=t.title,r=t.children;return m.a.createElement(b,{key:a,href:a,title:n},r.length>0&&r.map((function(t){return e(t)})))})))},I=(a(635),a(636)),j=(a(116),a(63)),L=(a(220),a(77)),C=(a(94),a(20)),w=(a(92),a(27)),k=(a(325),a(145)),N=(a(115),a(54)),S=(a(673),a(30)),R=(a(21),a(87)),T=a(262),x=a(263),P=a(295),A=a(264),M=a(297),F=(a(127),a(43)),D=(a(631),a(632)),_=a(129),q=a(32),V=a.n(q),H=a(224),J=N.a.TextArea;function K(e){var t=e.children,a=e.item,n=e.userInfo,r=e.articleId,i=e.commentId,l=e.replyId,u=e.replyVisible,f=a.user,g=Object(s.useState)(""),y=Object(o.a)(g,2),E=y[0],b=y[1];function h(){if(!n.userId)return L.a.warn("\u60a8\u672a\u767b\u9646\uff0c\u8bf7\u767b\u5f55\u540e\u518d\u8bd5\u3002");d.a.post("/discuss",{userId:n.userId,articleId:r,content:E.trim(),commentId:i}).then((function(t){e.onReply({commentId:0,replyId:0}),e.setCommentList(t.rows)}))}return Object(s.useEffect)((function(){u&&b("")}),[u]),m.a.createElement(I.a,{actions:[m.a.createElement("span",{onClick:function(){e.onReply({commentId:i,replyId:l})}},"Reply to"),m.a.createElement(m.a.Fragment,null,1===n.role&&m.a.createElement(D.a,{title:"\u662f\u5426\u5220\u9664\u8be5\u7559\u8a00\uff1f",cancelText:"\u53d6\u6d88",okText:"\u786e\u8ba4",onConfirm:function(){l?d.a.delete("/discuss/reply/".concat(l)).then((function(){var t=Object(_.a)(e.commentList),a=t.find((function(e){return e.id===i}));a.replies=a.replies.filter((function(e){return e.id!==l})),e.setCommentList(t)})):d.a.delete("/discuss/comment/".concat(i)).then((function(){var t=Object(_.a)(e.commentList);t=t.filter((function(e){return e.id!==i})),e.setCommentList(t)}))}},m.a.createElement(c.a,{type:"delete",className:"icon-delete"})))],author:m.a.createElement("span",null,f&&f.username),avatar:m.a.createElement(H.a,{userInfo:f}),content:m.a.createElement("div",{className:"article-detail",dangerouslySetInnerHTML:{__html:Object(p.g)(a.content,!0)}}),datetime:m.a.createElement(F.a,{title:a.createdAt},m.a.createElement("span",null,V()(a.createdAt).fromNow()))},u&&m.a.createElement("div",{className:"reply-form"},m.a.createElement(J,{placeholder:"\u56de\u590d".concat(a.user.username,"..."),value:E,onChange:function(e){b(e.target.value)},onKeyUp:function(e){e.ctrlKey&&13===e.keyCode&&h()}}),m.a.createElement("div",{className:"reply-form-controls"},m.a.createElement("span",{className:"tip"},"Ctrl or \u2318 + Enter"),m.a.createElement(w.a,{htmlType:"submit",type:"primary",disabled:!E.trim(),onClick:h},"\u56de\u590d"))),t)}var U=Object(S.b)((function(e){return{userInfo:e.user}}))(v=function(e){function t(){var e,a;Object(T.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(P.a)(this,(e=Object(A.a)(t)).call.apply(e,[this].concat(r)))).state={replyTarget:{commentId:0,replyId:0}},a.setReplyTarget=function(e){a.setState({replyTarget:e})},a}return Object(M.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.commentList,n=t.userInfo,r=t.articleId,c=this.state.replyTarget;return m.a.createElement("div",{className:"discuss-list"},a.map((function(t){return m.a.createElement(K,{item:t,key:t.id,articleId:r,userInfo:n,commentId:t.id,setCommentList:e.props.setCommentList,commentList:e.props.commentList,onReply:e.setReplyTarget,replyVisible:c.commentId===t.id&&!c.replyId},t.replies.map((function(a){return m.a.createElement(K,{item:a,key:a.id,articleId:r,userInfo:n,commentId:t.id,replyId:a.id,setCommentList:e.props.setCommentList,commentList:e.props.commentList,onReply:e.setReplyTarget,replyVisible:c.commentId===t.id&&c.replyId===a.id})})))})))}}]),t}(m.a.Component))||v,z=a(62),Q=N.a.TextArea,B=function(e){var t=e.onChange,a=e.onSubmit,n=e.submitting,r=e.value,i=e.articleId;return m.a.createElement("div",null,m.a.createElement(k.a.Item,null,m.a.createElement(Q,{rows:4,placeholder:"\u8bf4\u70b9\u4ec0\u4e48...",onChange:t,value:r})),m.a.createElement(k.a.Item,null,m.a.createElement("div",{className:"controls"},m.a.createElement(c.a,{type:"info-circle",className:"controls-tip-icon"}),m.a.createElement("span",{className:"controls-tip"},"\u652f\u6301 Markdown \u8bed\u6cd5"),m.a.createElement(w.a,{className:"disscus-btn",htmlType:"submit",loading:n,onClick:a,type:"primary"},-1!==i?"\u6dfb\u52a0\u8bc4\u8bba":"\u7559\u8a00"))))};var G=function(e){var t=Object(S.c)(),a=Object(z.b)(),n=Object(S.d)((function(e){return e.user})),r=n.username,l=(n.role,e.commentList),u=e.articleId,g=Object(s.useState)(""),y=Object(o.a)(g,2),E=y[0],b=y[1],h=f(),v=Object(o.a)(h,2),O=v[0],w=v[1];function k(e){switch(e.key){case"login":a.emit("openSignModal","login");break;case"register":a.emit("openSignModal","register");break;case"loginout":t(Object(R.b)())}}return m.a.createElement("div",{id:"discuss"},m.a.createElement("div",{className:"discuss-header"},m.a.createElement("span",{className:"discuss-count"},Object(p.a)(l)),-1!==u?"\u6761\u8bc4\u8bba":"\u6761\u7559\u8a00",m.a.createElement("span",{className:"discuss-user"},m.a.createElement(j.a,{overlay:r?m.a.createElement(C.a,{onClick:k},m.a.createElement(C.a.Item,{key:"loginout"},"\u6ce8\u9500")):m.a.createElement(C.a,{onClick:k},m.a.createElement(C.a.Item,{key:"login"},"\u767b\u5f55"),m.a.createElement(C.a.Item,{key:"register"},"\u6ce8\u518c")),trigger:["click","hover"]},m.a.createElement("span",null,r||"\u672a\u767b\u5f55\u7528\u6237"," ",m.a.createElement(c.a,{type:"down"})))),m.a.createElement(i.a,{className:"hr"})),m.a.createElement(I.a,{avatar:r?m.a.createElement(H.a,{userInfo:n}):m.a.createElement(c.a,{type:"github",theme:"filled",style:{fontSize:40,margin:"5px 5px 0 0"}}),content:m.a.createElement(B,{onChange:function(e){return b(e.target.value)},onSubmit:function(){if(E)return n.username?void w(d.a.post("/discuss",{articleId:e.articleId,content:E,userId:n.userId})).then((function(t){b(""),e.setCommentList(t.rows)})):L.a.warn("\u60a8\u672a\u767b\u9646\uff0c\u8bf7\u767b\u5f55\u540e\u518d\u8bd5\u3002")},submitting:O,value:E,articleId:u})}),m.a.createElement(U,{commentList:l,articleId:u,setCommentList:e.setCommentList}))};function W(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}t.default=function(e){var t=f(),a=Object(o.a)(t,2),E=a[0],b=a[1],h=Object(s.useState)({title:"",content:"",tags:[],categories:[],comments:[],createdAt:"",viewCount:0}),v=Object(o.a)(h,2),I=v[0],j=v[1],L=Object(s.useState)(!1),C=Object(o.a)(L,2),w=C[0],k=C[1];Object(s.useEffect)((function(){setTimeout((function(){var t=decodeURI(e.location.hash),a=document.querySelector('a[href="'.concat(t,'"]'));a&&t&&a.click()}),800)}),[]),Object(s.useEffect)((function(){b(d.a.get("/article/".concat(e.match.params.id))).then((function(e){e.content=Object(p.g)(e.content),j(e)})).catch((function(t){e.history.push("/404")}))}),[e.match.params.id]);var N=I.title,S=I.content,R=I.tags,T=I.categories,x=I.comments,P=I.createdAt,A=I.viewCount,M=parseInt(e.match.params.id),F=Object(u.useMediaQuery)({query:"(max-width: 1300px)"});return m.a.createElement(n.a,{tip:"Loading...",spinning:E},m.a.createElement("article",{className:"app-article",style:{paddingRight:F?0:275}},m.a.createElement("div",{className:"post-header"},m.a.createElement("h1",{className:"post-title"},N),m.a.createElement("div",{className:"article-desc"},m.a.createElement("span",{className:"post-time"},m.a.createElement(y.a,{type:"iconpost"}),"\xa0 Posted on \xa0",m.a.createElement("span",null,P.slice(0,10))),m.a.createElement(g.a,{tagList:R,categoryList:T}),m.a.createElement(i.a,{type:"vertical"}),m.a.createElement("a",{className:"comment-count",href:"#discuss",style:{color:"inherit"}},m.a.createElement(y.a,{type:"iconcomment"}),m.a.createElement("span",{style:{marginRight:5}}," ",Object(p.a)(x))),m.a.createElement(y.a,{type:"iconview",style:{marginRight:2}}),m.a.createElement("span",null,A))),m.a.createElement("div",{className:"article-detail",dangerouslySetInnerHTML:{__html:S}}),F?m.a.createElement(m.a.Fragment,null,m.a.createElement("div",{className:"drawer-btn",onClick:function(e){return k(!0)}},m.a.createElement(c.a,{type:"menu-o",className:"nav-phone-icon"})),m.a.createElement(r.a,{title:N,placement:"right",closable:!1,onClose:function(e){return k(!1)},visible:w,getContainer:function(){return document.querySelector(".app-article")}},m.a.createElement("div",{className:"right-navigation"},m.a.createElement(O,{content:S})))):m.a.createElement("nav",{className:"article-navigation"},m.a.createElement(O,{content:S})),m.a.createElement(G,{articleId:M,commentList:x,setCommentList:function(e){j(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?W(a,!0).forEach((function(t){Object(l.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):W(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},I,{comments:e}))}})))}}}]);